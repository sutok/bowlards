---
description: backendã«blowlardsã®ã‚¹ã‚³ã‚¢ã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ã‚’ã™ã‚‹ãŸã‚ã®APIã‚µãƒ¼ãƒãƒ¼ã‚’æ§‹ç¯‰
globs: backend
alwaysApply: false
---
ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãŒ SESæ¡ˆä»¶ ã§ã€ã‹ã¤ Firebase èªè¨¼ã‚’çµ„ã¿è¾¼ã‚“ã  Go API ã‚µãƒ¼ãƒãƒ¼ ã‚’ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªã«ã—ãŸã„ãªã‚‰ã€ä»¥ä¸‹ã®æ–¹å‘æ€§ãŒä¸€ç•ªã€Œå•†ç”¨æ¡ˆä»¶ã‚’å³ã“ãªã›ã‚‹ã€ã‚¢ãƒ”ãƒ¼ãƒ«ã«ãªã‚Šã¾ã™ã€‚

â¸»

ğŸ¯ SESæ¡ˆä»¶ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªã®æˆ¦ç•¥

1. æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯ï¼ˆGoç‰ˆ FastAPI+Pydantic ä½“é¨“ã«è¿‘ã„æ§‹æˆï¼‰
	â€¢	Webãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯:
	â€¢	Ginï¼ˆæ¡ç”¨å®Ÿç¸¾ãŒæœ€ã‚‚å¤šãã€å•†ç”¨ã§ã‚‚ã‚ˆãè¦‹ã‹ã‘ã‚‹ï¼‰
	â€¢	Echoã§ã‚‚OKã ãŒã€SESæ¡ˆä»¶ã§ã®æ±‚äººç¥¨ã‚’è¦‹ã‚‹ã¨ Ginã®è¨˜è¼‰ç‡ãŒé«˜ã„
	â€¢	èªè¨¼:
	â€¢	Firebase Authï¼ˆIDãƒˆãƒ¼ã‚¯ãƒ³ã‚’APIã§æ¤œè¨¼ï¼‰
	â€¢	Goã§ã¯å…¬å¼SDKãŒã‚ã‚‹ã®ã§ firebase.google.com/go/v4 ã‚’åˆ©ç”¨
	â€¢	ã‚µãƒ¼ãƒãƒ¼å´ã§ Authorization: Bearer <id_token> ã‚’å—ã‘å–ã‚Š â†’ Firebase SDK or REST APIã§æ¤œè¨¼
	â€¢	ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³:
	â€¢	go-playground/validator/v10
	â€¢	DTO struct ã®ã‚¿ã‚°ã§åˆ¶ç´„ã‚’æ›¸ã â†’ Pydanticã®ä»£æ›¿
	â€¢	APIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ:
	â€¢	swaggo/swag + Swagger UI
	â€¢	SESæ¡ˆä»¶ã§ã€ŒAPIä»•æ§˜æ›¸ã‚ã‚Šã¾ã™ã‹ï¼Ÿã€ã«å³ç­”ã§ãã‚‹å¼·åŠ›ãªæ­¦å™¨
	â€¢	ãƒ‡ãƒ¼ã‚¿å±¤:
	â€¢	DBã¯ PostgreSQL or MySQL
	â€¢	ORMã¯ GORM ãŒæ¨™æº–çš„ï¼ˆsqlcã¯é‡‘èç³»SESã ã¨é«˜è©•ä¾¡ï¼‰
	â€¢	é‹ç”¨/è£œåŠ©ãƒ„ãƒ¼ãƒ«:
	â€¢	Docker + docker-compose
	â€¢	Makefileï¼ˆlint/test/build/runï¼‰
	â€¢	CI/CDã¯ GitHub Actions
	â€¢	ç’°å¢ƒå¤‰æ•°ã¯ .env + spf13/viper

â¸»

2. èªè¨¼å‡¦ç†ã®æµã‚Œï¼ˆFirebaseé€£æºï¼‰
	1.	ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆWeb/ãƒ¢ãƒã‚¤ãƒ«ï¼‰ã§ Firebase Auth ã«ãƒ­ã‚°ã‚¤ãƒ³
	2.	IDãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—ã—ã€APIãƒªã‚¯ã‚¨ã‚¹ãƒˆã® Authorization ãƒ˜ãƒƒãƒ€ãƒ¼ã«ä»˜ä¸
	3.	APIã‚µãƒ¼ãƒãƒ¼ï¼ˆGo Ginï¼‰ãŒå—ã‘å–ã£ã¦ Firebase SDKã§æ¤œè¨¼

import (
    "context"
    "firebase.google.com/go/v4"
    "firebase.google.com/go/v4/auth"
    "google.golang.org/api/option"
    "github.com/gin-gonic/gin"
    "net/http"
)

func FirebaseAuthMiddleware(app *firebase.App) gin.HandlerFunc {
    return func(c *gin.Context) {
        client, _ := app.Auth(context.Background())
        idToken := c.GetHeader("Authorization")
        if idToken == "" {
            c.AbortWithStatusJSON(http.StatusUnauthorized, gin.H{"error": "missing token"})
            return
        }

        token, err := client.VerifyIDToken(context.Background(), idToken[len("Bearer "):])
        if err != nil {
            c.AbortWithStatusJSON(http.StatusUnauthorized, gin.H{"error": "invalid token"})
            return
        }

        c.Set("uid", token.UID)
        c.Next()
    }
}

ğŸ‘‰ Pydanticçš„ã€Œæ¤œè¨¼ã€= Firebase SDK ãŒã‚„ã£ã¦ãã‚Œã‚‹ã®ã§ã€å®‰å¿ƒæ„Ÿã‚’æŒãŸã›ã‚‰ã‚Œã‚‹ã€‚

â¸»

3. ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªã«å‘ãé¡Œæ

SESæ¡ˆä»¶ã‚’æ„è­˜ã™ã‚‹ãªã‚‰ã€**ã€Œæ¥­å‹™ã‚·ã‚¹ãƒ†ãƒ é¢¨ã€**ãŒåˆºã•ã‚Šã¾ã™ã€‚
ï¼ˆå˜ãªã‚‹TODOã‚¢ãƒ—ãƒªã§ã¯å·®åˆ¥åŒ–ã§ããªã„ï¼‰

âœ… å€™è£œä¾‹
	1.	ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†APIï¼ˆFirebaseèªè¨¼å¿…é ˆï¼‰
	â€¢	CRUD + æ¨©é™ä»˜ãã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
	â€¢	ä¾‹ï¼šä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯è‡ªåˆ†ã®ãƒ‡ãƒ¼ã‚¿ã®ã¿æ›´æ–°ã€ç®¡ç†è€…ã¯å…¨ä½“ã‚’ç®¡ç†
	2.	äºˆç´„ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ï¼ˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ + Firebase Authï¼‰
	â€¢	User / Reservation ãƒ¢ãƒ‡ãƒ«
	â€¢	Firebase Auth ã§ãƒ­ã‚°ã‚¤ãƒ³ â†’ è‡ªåˆ†ã®äºˆç´„ã ã‘å–å¾—ãƒ»å¤‰æ›´å¯èƒ½
	3.	ã‚¿ã‚¹ã‚¯é€²æ—ç®¡ç†ï¼ˆSESç¾å ´ã«è¿‘ã„ï¼‰
	â€¢	Firebase Auth ã§ç¤¾å“¡/ç®¡ç†è€…ã‚’åˆ†ã‘ã‚‹
	â€¢	ç®¡ç†è€…ã¯ã‚¿ã‚¹ã‚¯å‰²å½“APIã€ç¤¾å“¡ã¯è‡ªåˆ†ã®ã‚¿ã‚¹ã‚¯é€²æ—ã‚’æ›´æ–°

â¸»

4. è¦‹ã›æ–¹ã®å·¥å¤«ï¼ˆSESæ¡ˆä»¶ã§è©•ä¾¡ã•ã‚Œã‚‹ãƒã‚¤ãƒ³ãƒˆï¼‰
	â€¢	READMEã«æ§‹æˆå›³ã‚’è¼‰ã›ã‚‹
	â€¢	èªè¨¼ãƒ•ãƒ­ãƒ¼å›³ï¼ˆFirebase â†’ API â†’ DBï¼‰
	â€¢	ã‚³ãƒ³ãƒ†ãƒŠå›³ï¼ˆDocker Compose: API, DB, Swagger UIï¼‰
	â€¢	Swagger UIã®ã‚¹ã‚¯ã‚·ãƒ§ã‚’è²¼ã‚‹
â†’ ã€ŒAPIè¨­è¨ˆã§ãã‚‹ã€ã“ã¨ãŒä¼ã‚ã‚‹
	â€¢	Firebase Authã®æ¤œè¨¼ã‚³ãƒ¼ãƒ‰ã‚’å¼·èª¿
â†’ ã€Œå•†ç”¨æ¡ˆä»¶ã§å¿…é ˆã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’å®Ÿè£…ã—ãŸã€ã“ã¨ãŒã‚¢ãƒ”ãƒ¼ãƒ«ã§ãã‚‹
	â€¢	ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆã‚’ç¶ºéº—ã«ä¿ã¤

```
go-portfolio/
â”œâ”€â”€ cmd/
â”‚   â””â”€â”€ server/main.go
â”œâ”€â”€ internal/
â”‚   â”œâ”€â”€ api/        # handler
â”‚   â”œâ”€â”€ service/    # business logic
â”‚   â”œâ”€â”€ repository/ # DB
â”‚   â”œâ”€â”€ model/      # DTO
â”‚   â””â”€â”€ auth/       # Firebase middleware
â”œâ”€â”€ docs/           # swagger
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ docker-compose.yml
â””â”€â”€ Makefile
```


